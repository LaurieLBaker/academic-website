---
title: 'Creating: Where I work'
author: "Laurie Baker"
date: '2020-11-02T21:13:14-05:00'
categories: R
tags:
- R Markdown
- leaflet
- hugo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

# Creating the where I work map

<iframe seamless = "" width = "100%", height = "500" class="shortcode-iframe" src="leaflet/work_map.html"></iframe>

## Loading libraries

To create the interactive map I used the following libraries. Note that the library `fontawesome` is installed using devtools from github. 

```{r}

library(leaflet)
library(htmltools)
library(fontawesome)
library(htmlwidgets)
#devtools::install_github("rstudio/fontawesome")


```


## Creating the data frame.

I created a `work` data frame containing details of the latitude and longitude of locations where I've worked. 

```{r data, echo = FALSE}

work <- data.frame(
  "location" = c("Valparaiso, Chile", 
                 "Curitiba, Brasil", 
                 "Sable Island, Nova Scotia", 
                 "Greifswald, Germany",
                 "Arusha, Tanzania",
                 "Kigali, Rwanda",
                 "Kingston, Jamaica",
                 "Asuncion, Paraguay",
                 "East Kilbride, Scotland"), 
  "institute" = c("Instituto de Fomento Pesquero", 
                  "Universidade Federal do Parana", 
                  "Dalhousie University", 
                  "Friedrich Loeffler Institut",
                  "Nelson Mandela African Institute of Science and Technology",
                  "National Institute of Statistics Rwanda",
                  "Carribean National Statistical Offices",
                  "Paraguay Ministry of Health and Education",
                  "Foreign Commonwealth Development Office"), 
  "work" = c("Chilean Pink Cusk Eel", 
             "Fox rabies", 
             "Grey seals", 
             "Fox rabies",
             "Teaching",
             "Teaching",
             "Teaching",
             "Teaching",
             "Teaching"), 
  "lat" = c(-33.0472, 
            -25.4290, 
            43.9337, 
            54.0865,
            -3.3995,
            -1.9415,
            18.0179,
            -25.2637,
            55.760869), 
  "lon" = c(-71.6127, 
            -49.2671, 
            -59.9149, 
            13.3923,
            36.7968,
            30.0574,
            -76.8099,
            -57.5759,
            -4.22407), 
  "link" = c("<b><a href='http://lauriebaker.rbind.io/#projects'>Chilean Pink-cusk eel</a></b>", 
             "<b><a href='http://lauriebaker.rbind.io/project/internal-project/'>Outfoxing Rabies</a></b>", 
             "<b><a href='http://lauriebaker.rbind.io/#projects'>Grey Seals as Bioprobes</a></b>",  
             "<b><a href='http://lauriebaker.rbind.io/project/internal-project/'>Outfoxing Rabies</a></b>",  
             "<b><a href='http://lauriebaker.rbind.io/courses/'>R Training</a></b>",  
             "<b><a href='http://lauriebaker.rbind.io/courses/'>R Training</a></b>",  
             "<b><a href='http://lauriebaker.rbind.io/courses/'>R Training</a></b>",
             "<b><a href='http://lauriebaker.rbind.io/courses/'>R Training</a></b>",
             "<b><a href='http://lauriebaker.rbind.io/courses/'>R Training Courses</a></b>"), 
  "icon" = c("fish", 
             "disease", 
             "gps", 
             "disease",
             "training",
             "training",
             "training",
             "training", 
             "training"))


```

```{r head data}

head(work)

```


## Creating the labels

Next, I created the labels and icons to use on the map. I wanted to include a label including the institute where the work was carried out and also a link to the relevant page on my website. 

```{r labels}

labels <- sprintf(
  "<strong>%s</strong><br/>Project: %s",
  work$institute, work$link
) %>% lapply(htmltools::HTML)

```

## Creating the icons using `awesomeIconList`

I wanted to distinguish the different types of projects on the map (using symbols for my projects relating to dish, fish , and gps satellite tracking) and also I wanted to highlight the R training sessions I've run. I used different icons from the `fontawesome` package and used the argument `markerColor` to distinguish between training sessions and projects. 


```{r icons}

iconset <- awesomeIconList(
   fish = makeAwesomeIcon(text = fa("fish")),
   gps = makeAwesomeIcon(text = fa("satellite")),
   disease = makeAwesomeIcon(text = fa("syringe")),
   training = makeAwesomeIcon(text = fa("r-project"))
)

iconset2 <- awesomeIconList(
   fish = makeAwesomeIcon(text = fa("fish"), markerColor = "green"),
   gps = makeAwesomeIcon(text = fa("satellite"), markerColor = "green"),
   disease = makeAwesomeIcon(text = fa("syringe"), markerColor = "green"),
   training = makeAwesomeIcon(text = fa("r-project"), markerColor = "purple")
)


```


# Creating the leaflet map

```{r map, fig.cap='leaflet map'}


(work_map <- leaflet(work) %>% 
              addProviderTiles(providers$Stamen.Watercolor) %>%
              addProviderTiles(providers$Stamen.TerrainLabels) %>%
              addAwesomeMarkers(~lon, ~lat, icon = ~iconset2[icon], popup = ~labels))

```

## Getting the leaflet map to render on the website

After you've created the leaflet map, you'll need to save the .html and include it as an iframe. To incorporate this into your website you'll need to put the static folder. The first step is to use `htmlwidgets` and `htmltools` to create a widget. 


```{r create directory, eval = FALSE}

widget_path <- file.path("../../static/leaflet")

dir.create(widget_path)
```


```{r save widget, eval = FALSE}

saveWidget(work_map, file.path(widget_path,"work_map.html"))

```

When you save the map as a widget it creates the `work_map.html` file and also creates a folder with all the packages necessary to create the map. When you reference the map as an iframe you will want to reference it from within the "static" folder which contains images and other static features as below



`<iframe seamless = "" width = "100%", height = "500" class="shortcode-iframe" src="/leaflet/work_map.html"></iframe>`


